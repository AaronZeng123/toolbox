<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极度解压：键盘破坏者</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #111;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
            pointer-events: none;
            text-align: center;
            transition: opacity 0.5s;
        }
        #combo-counter {
            position: absolute;
            top: 20px;
            right: 60px;
            transform-origin: right top;
            color: #fff;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>

    <div id="instructions">
        <h1>按任意键开始解压</h1>
        <p>支持多键同时按下 • 开启声音体验更佳</p>
    </div>
    <div id="combo-counter">COMBO: 0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- 音效系统 (Web Audio API) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playSound(type) {
            if (!audioCtx) initAudio();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // 随机频率，制造混乱感
            const baseFreq = type === 'space' ? 100 : 200 + Math.random() * 600;
            oscillator.type = type === 'space' ? 'square' : 'sawtooth';
            oscillator.frequency.setValueAtTime(baseFreq, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.5);

            // 音量包络
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }

        // --- 视觉系统 ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // 颜色库
        const colors = [
            '#FF0055', '#00FF99', '#00CCFF', '#FFEE00', '#FF3300', '#CC00FF', '#FFFFFF'
        ];

        // 粒子类
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 10 + 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.life = 1.0;
                this.decay = Math.random() * 0.03 + 0.01;
                this.size = Math.random() * 5 + 2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2; // 重力
                this.vx *= 0.95; // 阻力
                this.vy *= 0.95;
                this.life -= this.decay;
            }

            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // 文字特效类
        class FloatingText {
            constructor(text, x, y, color) {
                this.text = text;
                this.x = x;
                this.y = y;
                this.color = color;
                this.vy = -5;
                this.life = 1.0;
                this.size = 50;
            }

            update() {
                this.y += this.vy;
                this.life -= 0.02;
                this.size += 1;
            }

            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.font = `bold ${this.size}px Arial`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(this.text, this.x, this.y);
            }
        }

        let particles = [];
        let floatingTexts = [];
        let shake = 0;
        let combo = 0;
        let comboTimer = null;
        const comboEl = document.getElementById('combo-counter');

        // --- 游戏循环 ---
        function loop() {
            // 背景（带拖尾效果）
            ctx.globalAlpha = 0.2;
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, width, height);

            // 屏幕震动
            ctx.save();
            if (shake > 0) {
                const dx = (Math.random() - 0.5) * shake;
                const dy = (Math.random() - 0.5) * shake;
                ctx.translate(dx, dy);
                shake *= 0.9;
                if (shake < 0.5) shake = 0;
            }

            // 更新绘制粒子
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.life <= 0) particles.splice(i, 1);
            }

            // 更新绘制文字
            for (let i = floatingTexts.length - 1; i >= 0; i--) {
                const t = floatingTexts[i];
                t.update();
                t.draw();
                if (t.life <= 0) floatingTexts.splice(i, 1);
            }

            ctx.restore();
            requestAnimationFrame(loop);
        }
        loop();

        // 解压词库
        const stressReliefWords = [
            "滚", "爽", "炸", "碎", "崩", "飞", "灭", "破", "散", "去",
            "加薪", "暴富", "躺平", "自由", "开心", "无虑", "放假", "通关", "无敌", "锦鲤",
            "退退退", "不干了", "去你的", "爱谁谁", "没关系", "你可以", "最棒了", "哈哈哈", "奥利给", "666",
            "烦恼消散", "霉运走开", "水逆退散", "一夜暴富", "心想事成", "万事如意", "百毒不侵", "元气满满"
        ];

        // --- 交互 ---
        window.addEventListener('keydown', (e) => {
            // 隐藏说明
            const instructions = document.getElementById('instructions');
            if (instructions.style.opacity !== '0') {
                instructions.style.opacity = '0';
            }

            // 初始化音频
            initAudio();

            // 随机位置
            const x = Math.random() * (width - 100) + 50;
            const y = Math.random() * (height - 100) + 50;
            const color = colors[Math.floor(Math.random() * colors.length)];

            // 生成爆炸粒子
            for (let i = 0; i < 30; i++) {
                particles.push(new Particle(x, y, color));
            }

            // 生成文字：随机选择一个解压词
            const randomWord = stressReliefWords[Math.floor(Math.random() * stressReliefWords.length)];
            floatingTexts.push(new FloatingText(randomWord, x, y, color));

            // 播放音效
            playSound(e.code === 'Space' ? 'space' : 'normal');

            // 屏幕震动
            shake = 20;

            // 连击系统
            combo++;
            comboEl.innerText = `COMBO: ${combo}`;
            comboEl.style.display = 'block';
            comboEl.style.color = color;
            comboEl.style.transform = `scale(${1 + combo * 0.01})`;
            
            clearTimeout(comboTimer);
            comboTimer = setTimeout(() => {
                combo = 0;
                comboEl.style.display = 'none';
            }, 1000);
        });

        // 触摸支持 (移动端适配)
        window.addEventListener('touchstart', (e) => {
            e.preventDefault();
            for (let i = 0; i < e.touches.length; i++) {
                const touch = e.touches[i];
                // 模拟按键事件逻辑
                initAudio();
                const x = touch.clientX;
                const y = touch.clientY;
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                for (let j = 0; j < 30; j++) {
                    particles.push(new Particle(x, y, color));
                }
                
                // 随机选择一个解压词
                const randomWord = stressReliefWords[Math.floor(Math.random() * stressReliefWords.length)];
                floatingTexts.push(new FloatingText(randomWord, x, y, color));
                
                playSound('normal');
                shake = 20;
            }
        });

    </script>
</body>
</html>
